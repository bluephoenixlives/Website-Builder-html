<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>One-file Website Builder — Export (GitHub Pages Ready)</title>
  <meta name="description" content="Single-file client-side website builder. Export single optimized index.html ready for GitHub Pages."/>
  <style>
    /* ---------- Minimal UI styles (kept small & efficient) ---------- */
    :root{ --bg:#071428; --panel:#0b1220; --muted:#9aa6b2; --accent:#7c3aed; --glass:rgba(255,255,255,0.03);}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:linear-gradient(180deg,#041124,#071428);color:#e6eef6}
    .wrap{display:grid;grid-template-columns:300px 1fr 360px;gap:12px;padding:14px;box-sizing:border-box;height:100vh}
    header.top{grid-column:1/-1;display:flex;justify-content:space-between;align-items:center}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#06b6d4);display:flex;align-items:center;justify-content:center;font-weight:700;color:#021018}
    .panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:12px;box-sizing:border-box;box-shadow:0 6px 18px rgba(2,6,23,0.6);height:calc(100vh - 110px);overflow:auto}
    .components .item{padding:10px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.02);cursor:grab;display:flex;flex-direction:column}
    .muted{color:var(--muted);font-size:13px}
    .canvas-wrap{display:flex;flex-direction:column;gap:8px;height:calc(100vh - 110px)}
    .canvas{background:#fff;border-radius:8px;flex:1;border:10px solid #e6eef6;overflow:auto}
    .page{min-height:640px;padding:36px;box-sizing:border-box;color:#102027;font-family:Inter, sans-serif}
    .drop-hint{padding:16px;color:#6b7280}
    label.small{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input[type="text"],input[type="color"],select,textarea{width:100%;padding:8px;border-radius:8px;border:none;background:rgba(0,0,0,0.04);color:inherit;box-sizing:border-box}
    .prop-row{margin-bottom:10px}
    button{background:var(--glass);border:1px solid rgba(255,255,255,0.04);color:inherit;padding:8px 10px;border-radius:8px;cursor:pointer}
    button.primary{background:linear-gradient(90deg,var(--accent),#06b6d4);color:#021018;font-weight:700;border:none}
    .selected{outline:3px dashed rgba(124,58,237,0.9)}
    pre.codebox{background:#071428;border-radius:8px;padding:12px;color:#dbeafe;overflow:auto;max-height:320px}
    .footer-note{font-size:12px;color:var(--muted);margin-top:8px}
    @media(max-width:1000px){.wrap{grid-template-columns:1fr;grid-template-rows:auto 1fr auto}.panel{height:220px}}
  </style>
</head>
<body>
  <div style="padding:12px 16px">
    <div class="brand" style="margin-bottom:8px">
      <div class="logo">WB</div>
      <div>
        <div style="font-weight:700;font-size:16px">One-file Website Builder</div>
        <div class="muted" style="font-size:12px">Single optimized index.html • GitHub Pages ready</div>
      </div>
    </div>
  </div>

  <div class="wrap" role="application" aria-label="Website builder">
    <header class="top">
      <div style="display:flex;gap:8px;align-items:center">
        <div class="muted">Mode:</div>
        <button id="editBtn" class="primary">Edit</button>
        <button id="previewBtn">Preview</button>
      </div>

      <div style="display:flex;gap:8px">
        <button id="downloadBtn">Download HTML</button>
        <button id="showExportBtn">Show Export & GitHub Steps</button>
        <button id="resetBtn">Reset</button>
      </div>
    </header>

    <!-- Left: components & assets -->
    <aside class="panel">
      <h3 style="margin-top:0">Components</h3>
      <div class="components" id="components">
        <div class="item" draggable="true" data-type="nav"><strong>Nav Bar</strong><span class="muted">— header links</span></div>
        <div class="item" draggable="true" data-type="hero"><strong>Hero</strong><span class="muted">— headline + CTA</span></div>
        <div class="item" draggable="true" data-type="text"><strong>Text Block</strong><span class="muted">— paragraph</span></div>
        <div class="item" draggable="true" data-type="two-col"><strong>Two Column</strong><span class="muted">— text + image</span></div>
        <div class="item" draggable="true" data-type="image"><strong>Image</strong><span class="muted">— uploaded or URL</span></div>
        <div class="item" draggable="true" data-type="button"><strong>Button</strong><span class="muted">— call-to-action</span></div>
        <div class="item" draggable="true" data-type="footer"><strong>Footer</strong><span class="muted">— copyright</span></div>
      </div>

      <hr style="border:none;height:12px">

      <h3 style="margin:6px 0">Assets</h3>
      <div class="muted" style="font-size:13px;margin-bottom:8px">Upload images to embed as data-URIs (included in exported file)</div>
      <input id="fileInput" type="file" accept="image/*" multiple />
      <div id="assetList"></div>

      <div class="footer-note">Tip: Upload logos & images here to reuse in your pages.</div>
    </aside>

    <!-- Canvas -->
    <main class="panel canvas-wrap">
      <div style="display:flex;gap:8px;align-items:center">
        <div class="muted">Canvas</div>
        <div class="muted" style="font-size:13px">Drag components into the white preview area; click to edit.</div>
      </div>

      <div class="canvas" id="canvas">
        <div class="page" id="page" data-title="My Site">
          <div class="drop-hint">Drag components from the left into the page area to build your site.</div>
        </div>
      </div>

      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="addSample">Add Sample Homepage</button>
      </div>
    </main>

    <!-- Inspector -->
    <aside class="panel" style="width:360px">
      <h3 style="margin-top:0">Inspector</h3>
      <div id="inspectorEmpty" class="muted">Select a component on the canvas to edit its properties.</div>

      <div id="inspector" style="display:none">
        <div style="display:flex;gap:8px;margin-bottom:8px">
          <button id="deleteBtn">Delete</button>
          <button id="duplicateBtn">Duplicate</button>
          <button id="bringFrontBtn">Bring front</button>
        </div>
        <div id="props"></div>
      </div>

      <hr style="margin:12px 0">

      <h3 style="margin:6px 0">Page Settings</h3>
      <label class="small">Site title</label>
      <input id="siteTitle" type="text" placeholder="My site" />
      <label class="small">Background color (page)</label>
      <input id="pageBg" type="color" value="#ffffff" />
      <label class="small">Font family</label>
      <select id="fontSelect">
        <option value="Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial">Inter / System</option>
        <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI</option>
        <option value="'Roboto', sans-serif">Roboto</option>
        <option value="'Georgia', serif">Georgia</option>
      </select>

      <div style="margin-top:12px">
        <label class="small">Preview</label>
        <div style="display:flex;gap:8px">
          <button id="openPreview">Open preview</button>
          <button id="toggleMobile">Toggle mobile width</button>
        </div>
      </div>

      <div class="footer-note">Exported file is single `index.html` — ready to commit to a GitHub repo for Pages.</div>
    </aside>
  </div>

  <!-- Export modal / code & steps -->
  <div id="exportModal" style="position:fixed;inset:0;background:rgba(2,6,23,0.7);display:none;align-items:center;justify-content:center;padding:20px;box-sizing:border-box">
    <div style="background:#071428;border-radius:10px;padding:16px;max-width:1100px;width:100%;color:#dbeafe">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>Export: index.html & GitHub Pages Steps</strong>
        <div style="display:flex;gap:8px">
          <button id="copyCodeBtn">Copy code</button>
          <button id="downloadExportBtn" class="primary">Download index.html</button>
          <button id="closeExportBtn">Close</button>
        </div>
      </div>

      <div style="display:flex;gap:12px">
        <div style="flex:1">
          <div class="muted" style="margin-bottom:6px">Generated HTML (single file, optimized):</div>
          <pre class="codebox" id="exportCode" spellcheck="false" contenteditable="false"></pre>
        </div>
        <div style="width:360px">
          <div class="muted">Step-by-step: Publish to GitHub Pages</div>
          <ol style="margin-top:8px">
            <li>Create a new GitHub repository (or open an existing one).</li>
            <li>Upload **this single** <code>index.html</code> to the repository root (or place in a `docs/` folder).</li>
            <li>Commit & push changes to the repository.</li>
            <li>Go to **Settings → Pages** in the repository (or Settings → Pages & branches).</li>
            <li>Select the branch (e.g., `main`) and folder (`root` or `/docs`) and click **Save**.</li>
            <li>After a minute or two GitHub will provide a URL (e.g., `https://username.github.io/repo-name/`).</li>
          </ol>
          <div style="margin-top:8px">
            <div class="muted">Quick tips</div>
            <ul>
              <li>If you use `docs/`, set Pages source to that folder.</li>
              <li>Index.html is standalone — images are embedded so no external hosting needed.</li>
              <li>To use a custom domain, configure it in Pages settings and add the DNS records at your provider.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
  (function(){
    // ========= Utilities =========
    const $ = id => document.getElementById(id);
    const canvas = $('canvas') || document.getElementById('canvas'); // fallback
    const page = $('page');
    let selected = null;
    let editMode = true;
    let mobilePreview = false;
    const assets = {}; // id -> dataURL

    // ========= Component drag & drop =========
    document.querySelectorAll('#components .item').forEach(item=>{
      item.addEventListener('dragstart', e=>{
        e.dataTransfer.setData('text/component', item.dataset.type);
      });
    });
    canvas.addEventListener('dragover', e=>e.preventDefault());
    canvas.addEventListener('drop', e=>{
      e.preventDefault();
      const type = e.dataTransfer.getData('text/component');
      if(type) addComponent(type);
    });

    // ========= Component factory =========
    function addComponent(type, where=document.getElementById('page')){
      let el;
      switch(type){
        case 'nav':
          el = create(`<nav data-component="nav" style="display:flex;justify-content:space-between;align-items:center;padding:12px 18px;"><div contenteditable="true" data-edit>Brand</div><div><a href="#">Home</a> &nbsp; <a href="#">About</a> &nbsp; <a href="#">Contact</a></div></nav>`);
          break;
        case 'hero':
          el = create(`<section data-component="hero" style="padding:60px 30px;text-align:center;border-radius:10px;background:linear-gradient(180deg,#eef2ff,#ffffff);color:#072b2b"><h1 contenteditable="true" data-edit>Your awesome headline</h1><p contenteditable="true" data-edit>A short subheading.</p><div><a class="cta" href="#" style="display:inline-block;padding:10px 18px;border-radius:8px;text-decoration:none;background:#7c3aed;color:white">Get started</a></div></section>`);
          break;
        case 'text':
          el = create(`<div data-component="text" style="padding:18px;"><p contenteditable="true" data-edit>Editable paragraph text.</p></div>`);
          break;
        case 'two-col':
          el = create(`<section data-component="two-col" style="display:grid;grid-template-columns:1fr 1fr;gap:20px;align-items:center;padding:18px"><div contenteditable="true" data-edit><h3>Heading</h3><p>Paragraph on left column.</p></div><div><img src="" alt="placeholder" data-placeholder style="max-width:100%;border-radius:8px;height:220px;object-fit:cover;background:#efefef"></div></section>`);
          break;
        case 'image':
          el = create(`<div data-component="image" style="padding:8px"><img src="" alt="uploaded" style="max-width:100%;border-radius:8px"></div>`);
          break;
        case 'button':
          el = create(`<div data-component="button" style="padding:8px"><a href="#" contenteditable="true" data-edit style="display:inline-block;padding:8px 14px;border-radius:8px;background:#0ea5a4;color:white;text-decoration:none">Click me</a></div>`);
          break;
        case 'footer':
          el = create(`<footer data-component="footer" style="padding:18px;text-align:center;color:#475569"><small contenteditable="true" data-edit>© ${new Date().getFullYear()} Your Name</small></footer>`);
          break;
        default:
          el = create(`<div data-component="custom" style="padding:12px">Custom</div>`);
      }
      where.appendChild(el);
      observeNewNode(el);
      return el;
    }

    function create(html){ const div=document.createElement('div'); div.innerHTML=html.trim(); return div.firstChild; }

    // ========= Selection & Inspector =========
    function observeNewNode(node){
      // Attach click handlers for selection & editing
      node.addEventListener('click', e=>{
        e.stopPropagation();
        selectNode(e.target.closest('[data-component]') || e.target);
      }, true);
      node.querySelectorAll('*').forEach(ch=>{
        ch.addEventListener('click', e=>{
          e.stopPropagation();
          selectNode(ch);
        }, true);
      });
    }

    document.addEventListener('click', e=>{
      if(!page.contains(e.target)) return;
      const comp = e.target.closest('[data-component]');
      if(!comp) { clearSelection(); return; }
    });

    function selectNode(el){
      clearSelection();
      selected = el;
      el.classList.add('selected');
      showInspector(el);
    }
    function clearSelection(){
      if(selected) selected.classList.remove('selected');
      selected = null;
      $('inspector').style.display = 'none';
      $('inspectorEmpty').style.display = '';
      $('props').innerHTML = '';
    }

    function showInspector(el){
      $('inspectorEmpty').style.display = 'none';
      $('inspector').style.display = '';
      const props = $('props'); props.innerHTML = '';

      // Generic props
      addProp(props, 'Tag', 'text', el.tagName.toLowerCase());
      addProp(props, 'Inner HTML', 'textarea', el.innerHTML, val=>{
        // simple update; reattach handlers afterwards
        try{ el.innerHTML = val; }catch(e){}
        observeNewNode(el);
      });
      addProp(props, 'Background', 'color', rgbToHex(getComputedStyle(el).backgroundColor), v=> el.style.background = v);
      addProp(props, 'Padding', 'text', getComputedStyle(el).padding, v=> el.style.padding = v);
      addProp(props, 'CSS Classes', 'text', el.className || '', v=> el.className = v);

      // If element contains img
      const img = el.tagName === 'IMG' ? el : el.querySelector && el.querySelector('img');
      if(img){
        addProp(props, 'Image src', 'text', img.src, v=> img.src = v);
        addProp(props, 'Upload image', 'file', '', files=>{
          if(files && files[0]) fileToDataURL(files[0]).then(data=>{
            img.src = data; registerAsset(files[0].name, data); renderAssets();
          });
        });
      }

      // If anchor with editable text
      const a = el.querySelector && el.querySelector('a[contenteditable]') || (el.tagName === 'A' && el.hasAttribute('contenteditable') ? el : null);
      if(a){
        addProp(props, 'Text', 'text', a.innerText, v=> a.innerText = v);
        addProp(props, 'Href', 'text', a.getAttribute('href')||'#', v=> a.setAttribute('href', v));
      }

      // actions
      $('deleteBtn').onclick = ()=>{ if(selected && confirm('Delete selected element?')){ selected.remove(); clearSelection(); } };
      $('duplicateBtn').onclick = ()=>{ if(selected){ const clone = selected.cloneNode(true); page.appendChild(clone); observeNewNode(clone); } };
      $('bringFrontBtn').onclick = ()=>{ if(selected) page.appendChild(selected); };
    }

    function addProp(parent,label,type,value,onChange){
      const wrapper=document.createElement('div'); wrapper.className='prop-row';
      const lbl=document.createElement('label'); lbl.className='small'; lbl.textContent=label; parent.appendChild(lbl);
      if(type==='textarea'){ const ta=document.createElement('textarea'); ta.value=value; ta.style.minHeight='80px'; ta.addEventListener('input',()=> onChange && onChange(ta.value)); parent.appendChild(ta); return; }
      if(type==='file'){ const input=document.createElement('input'); input.type='file'; input.accept='image/*'; input.addEventListener('change',()=> onChange && onChange(input.files)); parent.appendChild(input); return; }
      if(type==='color'){ const input=document.createElement('input'); input.type='color'; input.value=value||'#ffffff'; input.addEventListener('input',()=> onChange && onChange(input.value)); parent.appendChild(input); return; }
      const input=document.createElement('input'); input.type='text'; input.value=value||''; input.addEventListener('input',()=> onChange && onChange(input.value)); parent.appendChild(input);
    }

    // ========= Asset handling =========
    function fileToDataURL(file){ return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file); }); }
    function registerAsset(name,dataUrl){ const k = Date.now()+'-'+name; assets[k]=dataUrl; return k; }
    function renderAssets(){ const el=$('assetList'); el.innerHTML=''; Object.keys(assets).forEach(k=>{ const img=document.createElement('img'); img.src=assets[k]; img.alt=k; img.style.maxWidth='100%'; img.style.borderRadius='6px'; img.style.marginBottom='8px'; img.addEventListener('click', ()=>{ insertImageAtSelection(assets[k]); }); el.appendChild(img); }); }
    function insertImageAtSelection(dataUrl){
      const img = document.createElement('img'); img.src=dataUrl; img.style.maxWidth='100%';
      if(selected && selected.closest('[data-component]')){ selected.appendChild(img); observeNewNode(img); } else { page.appendChild(img); observeNewNode(img); }
    }
    $('fileInput').addEventListener('change', async e=>{ const files=Array.from(e.target.files||[]); for(const f of files){ const d=await fileToDataURL(f); registerAsset(f.name,d); } renderAssets(); e.target.value=''; });

    // ========= Mode toggles =========
    $('editBtn').addEventListener('click', ()=> setMode(true));
    $('previewBtn').addEventListener('click', ()=> setMode(false));
    function setMode(isEdit){
      editMode = isEdit;
      if(isEdit){ $('editBtn').classList.add('primary'); $('previewBtn').classList.remove('primary'); canvas.style.pointerEvents=''; page.querySelectorAll('[data-component]').forEach(n=> n.style.outline=''); }
      else{ $('previewBtn').classList.add('primary'); $('editBtn').classList.remove('primary'); canvas.style.pointerEvents='none'; page.querySelectorAll('[data-component]').forEach(n=> n.style.outline='none'); }
    }
    setMode(true);

    // ========= Export / sanitize =========
    // remove editor-only attributes and selected outlines; keep inline styles & embedded images as-is
    function buildExportHTML(){
      // clone to avoid mutating live page
      const clone = page.cloneNode(true);

      // remove editor attributes (data-component, data-placeholder, data-edit, contenteditable on export)
      const walker = document.createTreeWalker(clone, NodeFilter.SHOW_ELEMENT, null, false);
      const nodes = [];
      while(walker.nextNode()) nodes.push(walker.currentNode);
      nodes.forEach(n=>{
        n.removeAttribute('data-component');
        n.removeAttribute('data-placeholder');
        n.removeAttribute('data-edit');
        n.removeAttribute('contenteditable');
        n.classList.remove('selected');
        // remove internal-only outline styles if present
        if(n.style && n.style.outline) n.style.outline = '';
      });

      // Build minimal CSS optimized for export (system fonts; no external calls)
      const css = `/* Exported inline styles (minimal) */
:root{--accent:${getComputedStyle(document.documentElement).getPropertyValue('--accent')||'#7c3aed'};}
body{margin:0;font-family:${escapeHtml($('fontSelect').value||'Inter,system-ui, -apple-system, "Segoe UI", Roboto, Arial')};background:${escapeHtml($('pageBg').value||'#ffffff')};color:#0b1220}
img{max-width:100%;height:auto}
a{color:inherit;text-decoration:none}
.container{max-width:1100px;margin:0 auto;padding:24px}
`;

      // Wrap exported page content inside body
      const title = escapeHtml($('siteTitle').value || 'My Site');
      const exported = `<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>${title}</title>
<style>${css}</style>
</head>
<body>
${clone.outerHTML}
</body>
</html>`;
      return exported;
    }

    function escapeHtml(s){ return (s||'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    function downloadContent(filename, content, type='text/html'){
      const blob = new Blob([content], {type});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=> URL.revokeObjectURL(url), 3000);
    }

    $('downloadBtn').addEventListener('click', ()=>{
      const html = buildExportHTML();
      downloadContent('index.html', html);
    });

    // Export modal handlers
    $('showExportBtn').addEventListener('click', ()=>{
      const html = buildExportHTML();
      $('exportCode').textContent = html;
      $('exportModal').style.display = 'flex';
    });
    $('closeExportBtn').addEventListener('click', ()=> $('exportModal').style.display='none');
    $('copyCodeBtn').addEventListener('click', ()=> {
      const code = $('exportCode').textContent;
      navigator.clipboard.writeText(code).then(()=> alert('Exported code copied to clipboard.'));
    });
    $('downloadExportBtn').addEventListener('click', ()=> {
      const html = $('exportCode').textContent || buildExportHTML();
      downloadContent('index.html', html);
    });

    // ========= Sample & reset =========
    $('resetBtn').addEventListener('click', ()=> {
      if(confirm('Reset canvas? This will remove all content.')){ page.innerHTML = '<div class="drop-hint">Drag components from the left into the page area to build your site.</div>'; clearSelection(); }
    });
    $('addSample').addEventListener('click', ()=> {
      page.innerHTML = '';
      addComponent('nav');
      addComponent('hero');
      addComponent('two-col');
      addComponent('footer');
    });

    // ========= Preview controls =========
    $('openPreview').addEventListener('click', ()=>{
      const html = buildExportHTML();
      const blob = new Blob([html], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      window.open(url, '_blank');
      setTimeout(()=> URL.revokeObjectURL(url), 3000);
    });
    $('toggleMobile').addEventListener('click', ()=> {
      mobilePreview = !mobilePreview;
      if(mobilePreview){ canvas.style.maxWidth='420px'; canvas.style.margin='0 auto'; } else { canvas.style.maxWidth=''; canvas.style.margin=''; }
    });

    // ========= Utility: attach selection to nodes created by innerHTML ========
    // Instead of polling, use MutationObserver for better performance.
    const observer = new MutationObserver(muts=>{
      muts.forEach(m=>{
        (m.addedNodes||[]).forEach(node=>{
          if(node.nodeType===1){ // element
            if(node.hasAttribute && node.hasAttribute('data-component')) observeNewNode(node);
            node.querySelectorAll && node.querySelectorAll('[data-component]').forEach(n=> observeNewNode(n));
          }
        });
      });
    });
    observer.observe(page, {childList:true, subtree:true});

    // attach existing starter nodes if any
    setTimeout(()=>{ page.querySelectorAll('[data-component]').forEach(n=> observeNewNode(n)); }, 60);

    // keyboard shortcuts
    document.addEventListener('keydown', e=>{
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='s'){ e.preventDefault(); $('downloadBtn').click(); }
      if(e.key==='Delete' && selected){ selected.remove(); clearSelection(); }
    });

    // init starter nav
    addComponent('nav');

    // small helper to access elements by id
    function $(id){ return document.getElementById(id); }
  })();
  </script>
</body>
</html>
